<f:layout name="BE"/>

<f:section name="content">

    <div class="pxa-social-feed-be-token">
        <div class="js__pxasocialfeed-be-token-form">
            <h4>
                <f:translate key="tx_pxasocialfeed_module.token.header1"> Add new token or edit existing</f:translate>
            </h4>

            <f:form.validationResults for="token">
                <f:if condition="{validationResults.flattenedErrors}">
                    <f:then>
                        <f:for each="{validationResults.flattenedErrors}" key="propertyPath" as="errors">
                            <f:for each="{errors}" as="error">
                                <p class="bg-danger" style="padding: 15px;">{error.message}</p>
                            </f:for>
                        </f:for>
                    </f:then>
                    <f:else>
                        <f:flashMessages renderMode="div"/>
                    </f:else>
                </f:if>
            </f:form.validationResults>

            <f:form action="saveToken" name="token" controller="Feeds" object="{token}" enctype="multipart/form-data"
                    noCache="1">

                <table class="table table-bordered">
                    <tr>
                        <td>
                            <f:translate key="tx_pxasocialfeed_module.token.form.app_id"> App Id</f:translate>
                        </td>
                        <td>
                            <f:form.textfield property="appId"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <f:translate key="tx_pxasocialfeed_module.token.form.app_secret"> App Secret</f:translate>
                        </td>
                        <td>
                            <f:form.textfield property="appSecret"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <f:translate key="tx_pxasocialfeed_module.token.form.type"> Type</f:translate>
                        </td>
                        <td>
                            <f:form.select property="socialType"
                                           options="{1: 'Facebook', 2: 'Instagram', 3: 'Instagram (OAuth2)'}"/>
                        </td>
                    </tr>
                    <tr>
                        <td></td>

                        <td>
                            <f:form.submit class="btn btn-success" name="save"
                                           value="{f:translate(key: '{f:if(then: \'tx_pxasocialfeed_module.token.form.button_save\', else: \'tx_pxasocialfeed_module.token.form.create_new_token\', condition: isEditForm)}')}"/>
                            <input class="js__pxasocialfeed-be-token-form-clear-button btn btn-default" type="reset"
                                   value="<f:translate key='tx_pxasocialfeed_module.token.form.button_clear'> Clear Table </f:translate>"/>
                        </td>
                    </tr>
                </table>
            </f:form>
        </div>

        <div class="js__pxasocialfeed-be-show-all-tokens">
            <f:if condition="{tokens}">
                <f:then>
                    <h2>
                        <f:translate key="tx_pxasocialfeed_module.token.header2"> Available tokens object</f:translate>
                    </h2>
                    <div class="js__pxasocialfeed-be-tokens">
                        <table class="table table-striped">

                            <tr class="info">
                                <td><f:translate key="tx_pxasocialfeed_module.token.table.uid">uid</f:translate></td>
                                <td><f:translate key="tx_pxasocialfeed_module.token.form.app_id">App ID</f:translate></td>
                                <td><f:translate key="tx_pxasocialfeed_module.token.form.app_secret">App secret</f:translate></td>
                                <td><f:translate key="tx_pxasocialfeed_module.token.form.type">Token type</f:translate></td>
                                <td><f:translate key="tx_pxasocialfeed_module.token.form.access_token"/></td>
                                <td><f:translate key="tx_pxasocialfeed_module.token.form.edit"/></td>
                                <td><f:translate key="tx_pxasocialfeed_module.token.form.delete"/></td>
                            </tr>

                            <f:for each="{tokens}" as="tokenItem">

                                <tr class="js__pxasocialfeed-be-custom-token">
                                    <td>{tokenItem.uid}</td>
                                    <td>{tokenItem.appId}</td>
                                    <td><f:if condition="{tokenItem.appSecret}" then="{tokenItem.appSecret}" else="Not available"/></td>
                                    <td>{tokenItem.socialTypeDescription} ({tokenItem.socialType})</td>
                                    <td>
                                        <f:if condition="{tokenItem.accessToken}">
                                            <f:then>{tokenItem.accessToken}</f:then>
                                            <f:else>
                                                <f:if condition="{tokenItem.socialType} == 3">
                                                    <f:then>
                                                        <a class="btn btn-default" href="https://api.instagram.com/oauth/authorize/?client_id={tokenItem.appId}&redirect_uri={f:uri.action(action:'addAccessToken', absolute:1, arguments: {token: tokenItem})->f:format.urlencode()}&response_type=code">Generate access token</a>
                                                    </f:then>
                                                    <f:else>Not available</f:else>
                                                </f:if>
                                            </f:else>
                                        </f:if>
                                    </td>
                                    <td>
                                        <f:link.action action="addToken" class="btn btn-default" arguments="{token: tokenItem}">
                                            <f:translate key="tx_pxasocialfeed_module.token.form.edit"/>
                                        </f:link.action>
                                    </td>
                                    <td>
                                        <f:link.action action="deleteToken" class="btn btn-danger"
                                                       arguments="{token: tokenItem}"
                                                       additionalAttributes="{onClick: 'return checkDelete();'}">
                                            <f:translate key="tx_pxasocialfeed_module.token.form.delete"/>
                                        </f:link.action>
                                    </td>
                                </tr>

                            </f:for>

                        </table>
                    </div>
                </f:then>
                <f:else>
                    <h2>
                        <f:translate key="tx_pxasocialfeed_module.token.header3"> There is no created token</f:translate>
                    </h2>
                </f:else>
            </f:if>
        </div>
    </div>

</f:section>
